// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// =====================
//        USER
// =====================
model User {
  id              String           @id @default(uuid())
  name            String
  email           String           @unique
  password        String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  // Relations
  role            Role             @relation(fields: [roleId], references: [id])
  roleId          String
  
  createdProjects Project[]        @relation("ProjectCreator")
  projectMembers  ProjectMember[]
  assignments     Assignment[]
  comments        Comment[]
  fileAttachments FileAttachment[]

  @@map("users")
}

// =====================
//       ROLE
// =====================
model Role {
  id          String   @id @default(uuid())
  roleName    String   @unique
  permissions String[] // Array of permission strings
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  users       User[]

  @@map("roles")
}

// =====================
//      PROJECT
// =====================
model Project {
  id          String          @id @default(uuid())
  projectName String
  description String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  
  // Relations
  creator     User            @relation("ProjectCreator", fields: [creatorId], references: [id])
  creatorId   String
  
  members     ProjectMember[]
  tasks       Task[]

  @@map("projects")
}

// Junction table for Project members
model ProjectMember {
  id        String   @id @default(uuid())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  joinedAt  DateTime @default(now())

  @@unique([projectId, userId])
  @@map("project_members")
}

// =====================
//        TASK
// =====================
model Task {
  id          String           @id @default(uuid())
  title       String
  description String
  deadline    DateTime?
  progress    Int              @default(0)
  status      String           @default("Pending") // Pending, In Progress, Completed
  priority    String           @default("Medium") // Low, Medium, High
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  
  // Relations
  project     Project          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId   String
  
  subtasks    Subtask[]
  assignments Assignment[]
  comments    Comment[]
  files       FileAttachment[]

  @@map("tasks")
}

// =====================
//      SUBTASK
// =====================
model Subtask {
  id        String   @id @default(uuid())
  title     String
  progress  Int      @default(0)
  status    String   @default("Pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  taskId    String

  @@map("subtasks")
}

// =====================
//     ASSIGNMENT
// =====================
model Assignment {
  id         String   @id @default(uuid())
  assignedAt DateTime @default(now())
  
  // Relations
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  task       Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  taskId     String

  @@unique([userId, taskId])
  @@map("assignments")
}

// =====================
//      COMMENT
// =====================
model Comment {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  taskId    String

  @@map("comments")
}

// =====================
//   FILE ATTACHMENT
// =====================
model FileAttachment {
  id         String   @id @default(uuid())
  fileName   String
  fileType   String
  fileSize   BigInt
  filePath   String
  uploadedAt DateTime @default(now())
  
  // Relations
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  task       Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  taskId     String

  @@map("file_attachments")
}
